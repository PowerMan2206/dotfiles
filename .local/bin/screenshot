#!/bin/bash

# kill if running
# not actually the thing but good enough
if [[ $(pidof slurp) ]]; then
	pkill slurp
	exit
fi

save() {
	tee ~/scrs/$(date +'%Y-%m-%d_%H:%M:%S.png') | wl-copy
}

if [[ $2 == swappy ]]; then
	save() {
		swappy -f - -o - | tee ~/scrs/$(date +'%Y-%m-%d_%H:%M:%S.png') | wl-copy
	}
fi

case $1 in
	area )
		region="$(slurp -b 181b28ba -c e8e7e4 -d -w 1)"
		grim -g "$region" - | save
		;;
	window ) grim -g "$(swaymsg -t get_tree | jq -r 'recurse(.nodes[]?, .floating_nodes[]?) | select(.focused)' | jq -r '.rect | "\(.x),\(.y) \(.width)x\(.height)"')" - | save ;;
	dots )
		for i in {1..3}; do
			read -sn 1
			wl-paste > scr"$i".png
			echo "scr$i.png created"
		done
		
		convert scr1.png scr2.png scr3.png -append screenshot.png
		rm scr1.png scr2.png scr3.png
		;;
esac 
